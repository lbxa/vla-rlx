---
// BibTeX Citation Widget with copy-to-clipboard functionality
export interface Props {
  entry?: string;
}

// TODO: Replace with your actual BibTeX citation
const defaultBibTeX = `@article{yourname2024vla3dof,
  title={Vision-Language-Action Model for Low-Cost Robotic Manipulation},
  author={First Author and Second Author and Third Author},
  journal={arXiv preprint arXiv:XXXX.XXXXX},
  year={2024},
  url={https://vla.lbxa.net}
}`;

const { entry = defaultBibTeX } = Astro.props;
---

<div
  class="bibtex-widget my-6 overflow-hidden rounded-lg border border-nerfies-gray-300 bg-nerfies-gray-50"
>
  <div
    class="flex items-center justify-between border-b border-nerfies-gray-300 bg-nerfies-gray-100 px-4 py-2"
  >
    <span class="font-mono text-sm font-semibold text-nerfies-gray-500"
      >BibTeX Citation</span
    >
    <button
      id="copy-bibtex-btn"
      class="copy-btn rounded bg-nerfies-primary px-3 py-1 text-sm font-medium text-white transition-colors hover:bg-nerfies-primary-hover focus:outline-none focus:ring-2 focus:ring-nerfies-primary focus:ring-offset-1"
      data-bibtex={entry}
      aria-label="Copy BibTeX to clipboard"
    >
      <span class="btn-text">Copy</span>
    </button>
  </div>
  <pre
    class="overflow-x-auto p-4 text-sm leading-relaxed"><code class="bibtex-code font-mono text-nerfies-gray-500">{entry}</code></pre>
</div>

<script>
  function setupBibTeXCopy() {
    const copyBtn = document.getElementById("copy-bibtex-btn");
    if (!copyBtn) return;

    copyBtn.addEventListener("click", async () => {
      const bibtex = copyBtn.getAttribute("data-bibtex");
      if (!bibtex) return;

      try {
        await navigator.clipboard.writeText(bibtex);

        // Visual feedback
        const btnText = copyBtn.querySelector(".btn-text");
        if (btnText) {
          const originalText = btnText.textContent;
          btnText.textContent = "Copied!";
          copyBtn.classList.add("bg-green-600");
          copyBtn.classList.remove(
            "bg-nerfies-primary",
            "hover:bg-nerfies-primary-hover"
          );

          setTimeout(() => {
            btnText.textContent = originalText;
            copyBtn.classList.remove("bg-green-600");
            copyBtn.classList.add(
              "bg-nerfies-primary",
              "hover:bg-nerfies-primary-hover"
            );
          }, 2000);
        }
      } catch (err) {
        console.error("Failed to copy BibTeX:", err);
        const btnText = copyBtn.querySelector(".btn-text");
        if (btnText) {
          btnText.textContent = "Error!";
          setTimeout(() => {
            btnText.textContent = "Copy";
          }, 2000);
        }
      }
    });
  }

  // Initialize on page load
  document.addEventListener("DOMContentLoaded", setupBibTeXCopy);

  // Re-initialize after navigation (for SPAs)
  document.addEventListener("astro:page-load", setupBibTeXCopy);
</script>

<style>
  .bibtex-widget {
    max-width: 100%;
  }

  .bibtex-code {
    display: block;
    white-space: pre;
    word-wrap: normal;
  }

  pre {
    margin: 0;
  }

  .copy-btn {
    cursor: pointer;
    user-select: none;
  }

  .copy-btn:active {
    transform: scale(0.98);
  }
</style>
